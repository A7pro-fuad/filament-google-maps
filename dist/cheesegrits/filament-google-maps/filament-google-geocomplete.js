window.filamentGoogleGeocomplete=($wire,config)=>({geocoder:null,mapEl:null,config:{debug:!1,statePath:"",gmaps:"",filterName:null,reverseGeocodeFields:{},latLngFields:{},types:[],isLocation:!1,placeField:"formatted_address"},symbols:{"%n":["street_number"],"%z":["postal_code"],"%S":["street_address","route"],"%A1":["administrative_area_level_1"],"%A2":["administrative_area_level_2"],"%A3":["administrative_area_level_3"],"%A4":["administrative_area_level_4"],"%A5":["administrative_area_level_5"],"%a1":["administrative_area_level_1"],"%a2":["administrative_area_level_2"],"%a3":["administrative_area_level_3"],"%a4":["administrative_area_level_4"],"%a5":["administrative_area_level_5"],"%L":["locality"],"%D":["sublocality"],"%C":["country"],"%c":["country"]},loadGMaps:function(){if(document.getElementById("filament-google-maps-google-maps-js")){let waitForGlobal=function(key,callback){window[key]?callback():setTimeout(function(){waitForGlobal(key,callback)},100)};waitForGlobal("filamentGoogleMapsAPILoaded",function(){this.createAutocomplete()}.bind(this))}else{let script=document.createElement("script");script.id="filament-google-maps-google-maps-js",window.filamentGoogleMapsAsyncLoad=this.createAutocomplete.bind(this),script.src=this.config.gmaps+"&callback=filamentGoogleMapsAsyncLoad",document.head.appendChild(script)}},init:function(mapEl){this.mapEl=mapEl,this.config={...this.config,...config},this.loadGMaps()},createAutocomplete:function(){window.filamentGoogleMapsAPILoaded=!0;let fields=["address_components","formatted_address","geometry","name"];fields.includes(this.config.placeField)||fields.push(this.config.placeField);let geocompleteOptions={fields,strictBounds:!1,types:this.config.types},geocompleteEl=this.config.isLocation?this.config.statePath+"-fgm-address":this.config.statePath,geoComplete=document.getElementById(geocompleteEl);if(geoComplete){window.addEventListener("keydown",function(e){if((e.key==="U+000A"||e.key==="Enter"||e.code==="Enter")&&e.target.nodeName==="INPUT"&&e.target.type==="text")return e.preventDefault(),!1},!0);let autocomplete=new google.maps.places.Autocomplete(geoComplete,geocompleteOptions);autocomplete.addListener("place_changed",()=>{let place=autocomplete.getPlace();if(!place.geometry||!place.geometry.location){window.alert("No details available for input: '"+place.name+"'");return}this.setLocation(place),this.updateReverseGeocode(place),this.updateLatLng(place)});let geoLocate=document.getElementById(this.config.statePath+"-geolocate");geoLocate&&(this.geocoder=new google.maps.Geocoder,geoLocate.addEventListener("click",event=>{"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(position=>{var currentLatitude=position.coords.latitude,currentLongitude=position.coords.longitude,currentLocation={lat:currentLatitude,lng:currentLongitude};this.geocoder.geocode({location:currentLocation}).then(response=>{response.results[0]&&(geoComplete.setAttribute("value",response.results[0].formatted_address),this.setLocation(response.results[0]),this.updateReverseGeocode(response.results[0]),this.updateLatLng(response.results[0]))})})}))}},setLocation:function(place){if(this.config.isLocation?$wire.set(this.config.statePath,place.geometry.location):$wire.set(this.config.statePath,place[this.config.placeField]),this.config.filterName){let latPath=this.config.filterName+".latitude",lngPath=this.config.filterName+".longitude",lat=document.getElementById(latPath),lng=document.getElementById(lngPath);lat&&lng&&(lat.setAttribute("value",place.geometry.location.lat().toString()),lng.setAttribute("value",place.geometry.location.lng().toString()),$wire.set(latPath,place.geometry.location.lat().toString()),$wire.set(lngPath,place.geometry.location.lng().toString()))}},updateReverseGeocode:function(place){if(Object.keys(this.config.reverseGeocodeFields).length>0&&place.address_components){let replacements=this.getReplacements(place.address_components);for(let field in this.config.reverseGeocodeFields){let replaced=this.config.reverseGeocodeFields[field];for(let replacement in replacements)replaced=replaced.split(replacement).join(replacements[replacement]);for(let symbol in this.symbols)replaced=replaced.split(symbol).join("");replaced=replaced.trim(),$wire.set(field,replaced)}}},updateLatLng:function(place){Object.keys(this.config.latLngFields).length>0&&place.geometry&&($wire.set(this.config.latLngFields.lat,place.geometry.location.lat().toString()),$wire.set(this.config.latLngFields.lng,place.geometry.location.lng().toString()))},getReplacements:function(address_components){let replacements={};return address_components.forEach(component=>{for(let symbol in this.symbols)this.symbols[symbol].indexOf(component.types[0])!==-1&&(symbol===symbol.toLowerCase()?replacements[symbol]=component.short_name:replacements[symbol]=component.long_name)}),this.config.debug&&console.log(replacements),replacements}});
